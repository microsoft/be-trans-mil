{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Eval conversion",
            "type": "python",
            "request": "launch",
            "program": "cyted/preproc/crop_and_convert_ndpi_to_tiff.py",
            "console": "integratedTerminal",
            "justMyCode": true,
            "args": [
                "--image_column=H&E",
                "--dataset=cyted-raw-20221102",
                "--target_magnifications=10.0",
                "--num_workers=20",
                "--output_dataset=BEST2",
                "--automatic_output_name=True",
                "--display_name=preprocess_best2_he_slides",
                "--dataset_csv=exclude_wrong_stains_2022-11-22.tsv",
                "--converted_dataset_csv=dataset.tsv",
                "--bounding_box_path=cyted/preproc/files/he_bboxes_from_histoqc_masks_2022-12-14.json",
                "--mask_dataset=cyted-HE-histoqc-v2.1-20221125",
                "--datastore=westus2",
                "--docker_shm_size=900g",
                "--cluster=v100westus2",
            ]
        },
        {
            "name": "Python: Current File",
            "type": "python",
            "request": "launch",
            "program": "${file}",
            "console": "integratedTerminal",
            "justMyCode": false
        },
        {
            "name": "Convert ndpi to tiff",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/preproc/convert_cyted_ndpi_to_tiff.py",
            "console": "integratedTerminal",
            "args": [
                "--dataset=/cyted/cyted-raw-20221102",
                "--output_dataset=/tmp/test-convert-1",
                "--dataset_csv=reviewed_dataset_2023-02-10.tsv",
                "--target_magnifications=5.0",
                "--limit=2",
                "--num_workers=2",
                "--converted_dataset_csv=dataset.csv",
            ],
            "justMyCode": false,
        },
        {
            "name": "Convert and crop H&E ndpi to tiff",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/preproc/crop_and_convert_ndpi_to_tiff.py",
            "console": "integratedTerminal",
            "args": [
                "--dataset=/cyted/cyted-raw-20221102",
                "--bounding_box_path=${workspaceFolder}/cyted/preproc/files/he_bboxes_from_histoqc_masks_2022-12-14.json",
                "--mask_dataset=/cyted/cyted-HE-histoqc-v2.1-20221125",
                "--output_dataset=/tmp/test-crop-convert-he-1",
                "--dataset_csv=reviewed_dataset_2023-02-10.tsv",
                "--image_column=H&E",
                "--target_magnifications=5.0",
                "--converted_dataset_csv=dataset.tsv",
                "--plot_path=${workspaceFolder}/outputs/crop-convert-he-1/",
                "--limit=2",
                "--num_workers=2",
                "--automatic_output_name=False"
            ],
            "justMyCode": false,
        },
        {
            "name": "Convert and crop TFF3 ndpi to tiff",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/preproc/crop_and_convert_ndpi_to_tiff.py",
            "console": "integratedTerminal",
            "args": [
                "--dataset=/cyted/cyted-raw-20221102",
                "--image_column=TFF3",
                "--excluded_slides_csv=${workspaceFolder}/cyted/preproc/files/tff3_exclusion_list_20221216_165203.csv",
                "--bounding_box_path=${workspaceFolder}/cyted/preproc/files/tff3_control_tissue_exclusion_via_aml_labelling.json",
                "--output_dataset=/tmp/test-crop-convert-tff3-1",
                "--output_mask_dataset=/tmp/test-crop-convert-tff3-1-masks",
                "--dataset_csv=reviewed_dataset_2023-02-10.tsv",
                "--target_magnifications=5.0",
                "--converted_dataset_csv=dataset.tsv",
                "--plot_path=${workspaceFolder}/outputs/crop-convert-tff3-1/",
                "--limit=2",
                "--num_workers=2",
                "--automatic_output_name=False"
            ],
            "justMyCode": false,
        },
        {
            "name": "Register crop and convert TFF3 ndpi to tiff",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/preproc/register_crop_convert.py",
            "console": "integratedTerminal",
            "args": [
                "--dataset=/cyted/cyted-raw-20221102",
                "--image_column=TFF3",
                "--fixed_dataset=/cyted/cyted-raw-20221102",
                "--fixed_mask_dataset=/cyted/cyted-HE-histoqc-v2.1-20221125",
                "--bounding_box_path_fixed=${workspaceFolder}/cyted/preproc/files/he_bboxes_from_histoqc_masks_2022-12-14.json",
                "--bounding_box_path=${workspaceFolder}/cyted/preproc/files/tff3_control_tissue_exclusion_via_aml_labelling.json",
                "--output_dataset=/tmp/test-register-tff3-1",
                "--output_diff_dataset=/tmp/test-register-tff3-1-diff",
                "--output_transforms_dataset=/tmp/test-register-tff3-1-transforms",
                "--dataset_csv=reviewed_dataset_2023-02-10.tsv",
                "--target_magnifications=1.25",
                "--excluded_slides_csv=${workspaceFolder}/cyted/preproc/files/tff3_exclusion_list_20221216_165203.csv",
                "--preprocessed_moving_dataset=/cyted/preprocessed_TFF3_10x",
                "--converted_dataset_csv=dataset.tsv",
                "--limit=2",
                "--num_workers=2",
                "--hardcode_background=True",
                "--automatic_output_name=False"
            ],
            "justMyCode": false,
        },
        {
            "name": "Create Montage in Azure",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/hi-ml/hi-ml-cpath/src/health_cpath/scripts/create_montage.py",
            "console": "integratedTerminal",
            "args": [
                "--cluster=cpuwestus3",
                "--datastore=westus3",
                "--dataset=cyted-raw-20221102",
                "--include_by_slide_id=cyted/he.txt",
                "--image_glob_pattern=*.ndpi",
            ],
            "justMyCode": false,
        },
        {
            "name": "Create Montage locally",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/hi-ml/hi-ml-cpath/src/health_cpath/scripts/create_montage.py",
            "console": "integratedTerminal",
            "args": [
                "--dataset=/cyted/cyted-raw-20221102/",
                "--include_by_slide_id=cyted/he.txt",
                "--image_glob_pattern=*.ndpi",
            ],
            "justMyCode": false,
        },
        {
            "name": "Python: Train TFF3_HECytedMIL locally",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/runner.py",
            "console": "integratedTerminal",
            "args": [
                "--model=cyted.configs.TFF3_HECytedMIL",
                "--crossval_count=0",
                "--max_bag_size=10",
                "--max_bag_size_inf=10",
                "--batch_size=2",
                "--tune_encoder=True",
                "--pl_limit_train_batches=2",
                "--pl_limit_test_batches=2",
                "--pl_limit_val_batches=2",
                "--max_epochs=1",
                "--max_num_gpus=1",
                "--strictly_aml_v1=False",
                "--num_top_slides=2",
                "--num_top_tiles=2",
                "--datastore=westeurope",
                "--pl_log_every_n_steps=2",
                "--max_num_workers=2",
                "--level=0",
                "--pl_deterministic=False",
                "--smoke_run=True",
            ],
            "justMyCode": false,
        },
        {
            "name": "Estimate Slides Brown Stain Ratio",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/analysis/slide_brown_stain_ratio.py",
            "console": "integratedTerminal",
            "args": [
                "--dataset=/cyted/preprocessed_TFF3_10x",
                "--dataset_csv=dataset.tsv",
                "--image_column=TFF3",
                "--excluded_slides_csv=${workspaceFolder}/cyted/preproc/files/tff3_exclusion_list_20221216_165203.csv",
                "--downsample_factor=1",
                "--background_val=255",
                "--area_threshold=64",
                "--plot_path=${workspaceFolder}/outputs/brown_stain_ratio/",
                "--limit=2",
                "--num_workers=1",
                "--level=0",
                "--variance_threshold=5e6"
            ],
            "justMyCode": false,
        },
        {
            "name": "Estimate Tiles Count of H&E slides",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/analysis/slide_tiles_count.py",
            "console": "integratedTerminal",
            "args": [
                "--dataset=/cyted/crop_and_convert_he_10x_to_tiff_no_hardcoded_bckd_2023_01_17",
                "--dataset_csv=dataset.tsv",
                "--image_column=H&E",
                "--limit=2",
                "--num_workers=1",
                "--level=0",
            ],
            "justMyCode": false,
        },
        {
            "name": "Python: Run best H&E ensemble",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/scripts/aggregate_and_ensemble_results.py",
            "console": "integratedTerminal",
            "args": [
                "--run_id=HD_81ad64b5-e03a-4373-9387-235a224314c8",
                "--workspace_config=config.json",
                "--ensemble_method=mean_probs",
                "--additional_run_ids=TFF3_HECytedMIL_Resnet50_1678872123066,TFF3_HECytedMIL_Resnet50_1678957021554"
            ],
            "justMyCode": false,
        },
        {
            "name": "Python: Run best TFF3 ensemble",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/scripts/aggregate_and_ensemble_results.py",
            "console": "integratedTerminal",
            "args": [
                "--run_id=HD_85dd0814-6587-4cc9-9a2c-50c300a8d624",
                "--workspace_config=config.json",
                "--ensemble_method=mean_probs"
            ],
            "justMyCode": false,
        },
        {
            "name": "Estimate Tiles Brown Stain Ratio",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/analysis/tiles_brown_stain_ratio.py",
            "console": "integratedTerminal",
            "args": [
                "--dataset=/cyted/preprocessed_TFF3_10x",
                "--dataset_csv=dataset.tsv",
                "--image_column=TFF3",
                "--tile_size=224",
                "--excluded_slides_csv=${workspaceFolder}/cyted/preproc/files/tff3_exclusion_list_20221216_165203.csv",
                "--downsample_factor=1",
                "--background_val=255",
                "--area_threshold=64",
                "--plot_path=${workspaceFolder}/outputs/brown_stain_ratio/",
                "--limit=2",
                "--num_workers=1",
                "--level=0",
            ],
            "justMyCode": false,
        },
        {
            "name": "Python: Run best H&E ensemble",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/scripts/aggregate_and_ensemble_results.py",
            "console": "integratedTerminal",
            "args": [
                "--run_id=HD_81ad64b5-e03a-4373-9387-235a224314c8",
                "--workspace_config=config.json",
                "--ensemble_method=mean_probs",
                "--additional_run_ids=TFF3_HECytedMIL_Resnet50_1678872123066,TFF3_HECytedMIL_Resnet50_1678957021554"
            ],
            "justMyCode": false,
        },
        {
            "name": "Python: Run best TFF3 ensemble",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/cyted/scripts/aggregate_and_ensemble_results.py",
            "console": "integratedTerminal",
            "args": [
                "--run_id=HD_85dd0814-6587-4cc9-9a2c-50c300a8d624",
                "--workspace_config=config.json",
                "--ensemble_method=mean_probs"
            ],
            "justMyCode": false,
        },
        {
            "name": "Runner in eval mode",
            "type": "python",
            "request": "launch",
            "program": "hi-ml/hi-ml/src/health_ml/runner.py",
            "console": "integratedTerminal",
            "justMyCode": false,
            "args": [
                "--model=cyted.TFF3_HECytedMIL_Resnet50",
                "--mode=eval_full",
                "--cluster=ND96v4-80GB-EastUS2",
                "--mount_in_azureml",
                "--src_checkpoint=HD_81ad64b5-e03a-4373-9387-235a224314c8_1:checkpoint_max_val_accuracy.ckpt",
                "--azure_datasets=crop_and_convert_he_10x_to_tiff_no_hardcoded_bckd_2023_01_17_v1",
            ]
        },
    ]
}
